#************************************************************
# Makefile
# written   January 2005 Magne Guttormsen
# modified  December 2008 Alexander Buerger
#************************************************************

         F95 = gfortran -W -Wall -O3 -ffixed-line-length-132
         CC = gcc -W -Wall -O3
         LIBS = -lm
         RWLIB = rewr/rewr_JEM.a
	     INSTALL_BIN = install -m 0755
         INSTALL_DIR = $(UIO_APPLICATIONS)/prog
         RM = -rm -f

TARGET  = rhosigchi_inputfgv
# mtcp mag2mag mag2disc disc2mag

C_SOURCES = shiva2paw.c waiting.c kin.c hex.c rocket.c normalization.c \
    binomialc.c micro.c counting.c gammex.c d2rho.c combi.c scissors.c\
    extendspin.c
# mtcp.c mag2mag.c mag2disc.c disc2mag.c
C_TARGETS = $(C_SOURCES:%.c=%)

F_SOURCES = rhosigchi_inputfgv
# angle.f
F_TARGETS = $(F_SOURCES:%.f=%)

# if make needs to do something in kinz, KINZ_IF_NEEDED will be
# 'kinz', otherwise it will be empty
KINZ_IF_NEEDED = $(shell make -q -C kinz > /dev/null || echo kinz)

REWR_IF_NEEDED = $(shell make -q -C rewr rewr.a > /dev/null || echo rewr)


all: $(KINZ_IF_NEEDED) $(REWR_IF_NEEDED) $(TARGET)

#kinz:
#	make -C kinz all

cprogs: $(C_TARGETS)

fprogs: $(F_TARGETS)

install:
	-mkdir $(INSTALL_DIR)/bin
	for program in $(TARGET) ; \
	    do $(INSTALL_BIN) $$program $(INSTALL_DIR)/bin/$$program; \
	done

$(F_TARGETS): %: %.f $(RWLIB)
	$(F95) -o  $* $*.f $(RWLIB)

$(C_TARGETS): %: %.c
	$(CC) -o  $* $*.c -lm

rewr $(RWLIB):
	make -C rewr rewr.a

clean: 
	make -C rewr clean
#	make -C kinz clean
	$(RM) *.o core *[~%]

very-clean: clean
	make -C rewr very-clean
#	make -C kinz very-clean
	$(RM) $(C_TARGETS) $(F_TARGETS) bin/$(TARGET)
	for target in $(TARGET) ; \
		do rm -f $(UIO_APPLICATIONS)/prog/bin/$$target ; \
	done

.PHONY: kinz rewr

.SUFFIXES:
